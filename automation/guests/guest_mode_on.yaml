id: "guest_mode_on"
initial_state: "on"
alias: "Guest mode on"
trigger:
  - platform: state
    entity_id: group.guests
    from: "not_home"
    to: "home"
  - platform: homeassistant
    event: start
condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: "off"
  - condition: state
    entity_id: group.guests
    state: "home"
action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.guest_mode

  # Wait 2 mins to see if an announcement has been made
  - delay: "00:20"

  # If a guest has already been announced then
  # lets skip the guest mode announcement
  - condition: state
    entity_id: input_boolean.guest_mode_announced
    state: "off"
  # Announcement
  - service: script.general_announcement
    data:
      speech_message: >-
        {{
          [
            "Guest mode has been enabled.",
            "Guests have arrived, act accordingly.",
            "You're not alone. Guest mode enabled.",
            "Pardon the interruption, but you have guests.",
            "Attention! Guest mode has been enabled."
          ] | random
        }}
      media_players: "auto"
